<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i To√°n ƒê·ªë Vui (L·ªõp 1)</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- T·∫£i th∆∞ vi·ªán Tone.js cho √¢m thanh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* Thi·∫øt l·∫≠p font Inter v√† ƒë·∫£m b·∫£o n·ªÅn th√¢n thi·ªán v·ªõi tr·∫ª em */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #fceabb 0%, #f8b500 100%); /* Gradient v√†ng cam t∆∞∆°i s√°ng */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Gi·ªØ n·ªôi dung ·ªü tr√™n c√πng, t·ªët cho mobile */
            padding: 20px;
        }

        .game-container {
            max-width: 768px; /* T·ªëi ƒëa cho iPad */
            width: 95%;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 20px;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .timer-display {
            background-color: #ef4444; /* ƒê·ªè t∆∞∆°i */
            color: white;
            font-size: 2rem;
            font-weight: 900;
            border-radius: 15px;
            padding: 10px 0;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 5px #b91c1c;
        }
        
        .timer-display.low-time {
            background-color: #fcd34d; /* V√†ng c·∫£nh b√°o */
            color: #b45309;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .question-card {
            background-color: #fff3c9; /* V√†ng nh·∫°t */
            border: 4px solid #f97316; /* Cam ƒë·∫≠m */
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            min-height: 150px; /* Chi·ªÅu cao t·ªëi thi·ªÉu cho c√¢u h·ªèi */
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-bottom: 20px;
        }

        .option-button {
            transition: all 0.2s ease;
            transform: scale(1);
            font-size: 1.1rem;
            padding: 15px 10px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px #d97706;
            background-color: #f59e0b; /* V√†ng cam */
        }

        .option-button:hover:not(:disabled) {
            transform: scale(1.03);
            box-shadow: 0 2px #d97706;
        }

        .option-button:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 #d97706;
        }

        /* Hi·ªáu ·ª©ng cho n√∫t khi ƒë∆∞·ª£c ch·ªçn (ƒë·ªÉ tr√°nh nh·∫•p nh√°y khi disable) */
        .option-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: scale(1);
            box-shadow: 0 4px #d97706;
        }
        
        /* Modal Feedback & Review Style */
        .feedback-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none; /* ·∫®n theo m·∫∑c ƒë·ªãnh */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .feedback-content {
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            animation: popIn 0.3s forwards;
            max-width: 90%;
        }
        
        /* C·∫ßn ƒëi·ªÅu ch·ªânh padding cho mobile ƒë·ªÉ kh√¥ng b·ªã qu√° to */
        @media (max-width: 640px) {
             .feedback-content {
                padding: 20px;
            }
        }

        @keyframes popIn {
            to { transform: scale(1); }
        }

        .emoji {
            font-size: 4rem;
        }

        /* N√∫t ƒëi·ªÅu h∆∞·ªõng */
        .nav-button {
            background-color: #3b82f6; /* Xanh d∆∞∆°ng */
            box-shadow: 0 4px #1d4ed8;
            padding: 10px 15px;
            font-size: 1rem;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .nav-button:disabled {
            background-color: #93c5fd;
            box-shadow: 0 4px #60a5fa;
            opacity: 0.8;
            cursor: not-allowed;
        }

        .nav-button:hover:not(:disabled) {
            transform: scale(1.03);
            box-shadow: 0 2px #1d4ed8;
        }
        .nav-button:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 #1d4ed8;
        }

    </style>
</head>
<body>

    <div id="gameContainer" class="game-container">
        <!-- TI√äU ƒê·ªÄ -->
        <h1 class="text-3xl font-black text-center text-orange-600 mb-6 border-b-4 border-orange-300 pb-2">
            üß† TO√ÅN ƒê·ªê VUI NH·ªòN (L·ªöP 1)
        </h1>
        
        <!-- TH·ªúI GIAN ƒê·∫æM NG∆Ø·ª¢C -->
        <div id="timerDisplay" class="timer-display">
            ‚è∞ 3:00
        </div>

        <!-- HI·ªÇN TH·ªä ƒêI·ªÇM S·ªê -->
        <div id="stats" class="flex justify-around items-center mb-6 p-3 bg-blue-100 rounded-lg shadow-inner">
            <div class="text-center">
                <p class="text-sm font-bold text-gray-600">T·ªïng S·ªë C√¢u</p>
                <p id="totalQuestions" class="text-2xl font-black text-blue-700"></p>
            </div>
            <div class="text-center">
                <p class="text-sm font-bold text-gray-600">ƒê√∫ng</p>
                <p id="correctCount" class="text-2xl font-black text-green-600">0</p>
            </div>
            <div class="text-center">
                <p class="text-sm font-bold text-gray-600">Sai / B·ªè Qua</p>
                <p id="incorrectCount" class="text-2xl font-black text-red-600">0</p>
            </div>
            <div class="text-center">
                <p class="text-sm font-bold text-gray-600">C√¢u Hi·ªán T·∫°i</p>
                <p id="currentQuestionNumber" class="text-2xl font-black text-purple-700">1</p>
            </div>
        </div>

        <!-- KHUNG C√ÇU H·ªéI -->
        <div id="questionCard" class="question-card">
            <p id="questionText">ƒêang t·∫£i c√¢u h·ªèi...</p>
        </div>

        <!-- KHU V·ª∞C ƒê√ÅP √ÅN -->
        <div id="optionsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- C√°c n√∫t ƒë√°p √°n s·∫Ω ƒë∆∞·ª£c ch√®n b·∫±ng JS -->
        </div>
        
        <!-- N√öT ƒêI·ªÄU H∆Ø·ªöNG -->
        <div id="navigationButtons" class="flex justify-between mt-6">
            <button id="prevButton" class="nav-button" disabled>&#9664; Quay L·∫°i</button>
            <button id="nextButton" class="nav-button">Ti·∫øp Theo &#9654;</button>
        </div>
    </div>

    <!-- MODAL HI·ªÇN TH·ªä PH·∫¢N H·ªíI -->
    <div id="feedbackModal" class="feedback-modal">
        <div id="feedbackContent" class="feedback-content">
            <div class="emoji" id="feedbackEmoji"></div>
            <h3 class="text-3xl font-bold mt-2 mb-4" id="feedbackTitle"></h3>
            <p class="text-gray-700 mb-6" id="feedbackMessage"></p>
            <button id="modalNextButton" class="nav-button w-full sm:w-1/2 mx-auto" disabled>
                Ti·∫øp T·ª•c
            </button>
        </div>
    </div>

    <!-- K·∫æT TH√öC B√ÄI T·∫¨P (C√ì N√öT √îN T·∫¨P) -->
    <div id="quizEnd" class="hidden question-card bg-green-500 text-white border-green-700" style="min-height: 250px;">
        <h2 class="text-4xl font-black">HO√ÄN TH√ÄNH! üéâ</h2>
        <p class="text-xl mt-4">Con ƒë√£ ho√†n th√†nh to√†n b·ªô b√†i t·∫≠p.</p>
        <p class="text-2xl font-bold mt-2">T·ªïng k·∫øt: <span id="finalScore" class="text-yellow-300"></span></p>
        
        <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4 mt-6">
            <button onclick="showReviewScreen()" class="p-3 bg-blue-600 text-white rounded-full font-bold shadow-lg hover:bg-blue-700 transition duration-300">
                üìñ √în T·∫≠p L·∫°i
            </button>
            <button onclick="window.location.reload()" class="p-3 bg-white text-green-600 rounded-full font-bold shadow-lg hover:shadow-xl transition duration-300">
                Ch∆°i L·∫°i
            </button>
        </div>
    </div>
    
    <!-- REVIEW MODAL -->
    <div id="reviewModal" class="feedback-modal">
        <div class="feedback-content max-w-xl w-full p-6" style="max-height: 90vh; overflow-y: auto;">
            <h3 class="text-3xl font-bold text-blue-700 mb-4 border-b pb-2">üìñ B·∫£ng T·ªïng K·∫øt √în T·∫≠p</h3>
            <p class="text-lg mb-4">
                ƒê√∫ng: <span id="reviewCorrect" class="font-bold text-green-600">0</span> |
                Sai/B·ªè qua: <span id="reviewIncorrect" class="font-bold text-red-600">0</span>
            </p>
            <div id="reviewList" class="space-y-3">
                <!-- Danh s√°ch c√¢u h·ªèi s·∫Ω ƒë∆∞·ª£c t·∫°o ·ªü ƒë√¢y -->
            </div>
            <button onclick="hideReviewScreen()" class="nav-button w-full mt-6 bg-gray-500 hover:bg-gray-600 shadow-none">
                Quay L·∫°i T·ªïng K·∫øt
            </button>
        </div>
    </div>


    <script>
        // --- 1. D·ªÆ LI·ªÜU C√ÇU H·ªéI (50 B√ÄI TO√ÅN ƒê·ªê L·ªöP 1) ---
        const initialQuestions = [
            { question: "Lan c√≥ 10 c√°i b√°nh, cho Hoa 3 c√°i. H·ªèi Lan c√≤n bao nhi√™u c√°i b√°nh?", options: ["6 c√°i", "7 c√°i", "8 c√°i", "13 c√°i"], answer: 7, explanation: "10 - 3 = 7 c√°i b√°nh." },
            { question: "M·∫π mua 20 c√°i b√°nh, b√© ƒÉn h·∫øt 2 c√°i. H·ªèi c√≤n bao nhi√™u c√°i?", options: ["19 c√°i", "18 c√°i", "17 c√°i", "22 c√°i"], answer: 18, explanation: "20 - 2 = 18 c√°i b√°nh." },
            { question: "M·∫π ƒë∆∞a cho Th√πy 10 ngh√¨n, Th√πy ƒëi mua hoa m·∫•t 5 ngh√¨n. H·ªèi Th√πy c√≤n bao nhi√™u ti·ªÅn?", options: ["4 ngh√¨n", "5 ngh√¨n", "15 ngh√¨n", "10 ngh√¨n"], answer: 5, explanation: "10 - 5 = 5 ngh√¨n ƒë·ªìng." },
            { question: "B·ªë cho An 5 vi√™n k·∫πo, m·∫π cho th√™m 4 vi√™n. H·ªèi An c√≥ t·∫•t c·∫£ bao nhi√™u vi√™n k·∫πo?", options: ["8 vi√™n", "9 vi√™n", "10 vi√™n", "1 vi√™n"], answer: 9, explanation: "5 + 4 = 9 vi√™n k·∫πo." },
            { question: "Tr√™n c√¢y c√≥ 15 con chim. 8 con bay ƒëi. H·ªèi c√≤n l·∫°i m·∫•y con?", options: ["7 con", "6 con", "9 con", "23 con"], answer: 7, explanation: "15 - 8 = 7 con chim." },
            { question: "H√¥m qua An t√¥ 2 b·ª©c tranh. H√¥m nay t√¥ 3 b·ª©c. Ng√†y mai t√¥ 4 b·ª©c. H·ªèi An t√¥ t·ªïng c·ªông bao nhi√™u b·ª©c?", options: ["7 b·ª©c", "8 b·ª©c", "9 b·ª©c", "10 b·ª©c"], answer: 9, explanation: "2 + 3 + 4 = 9 b·ª©c tranh." },
            { question: "L·ªõp c√≥ 18 b·∫°n. 10 b·∫°n l√† n·ªØ. H·ªèi c√≥ bao nhi√™u b·∫°n nam?", options: ["9 b·∫°n", "8 b·∫°n", "10 b·∫°n", "7 b·∫°n"], answer: 8, explanation: "18 - 10 = 8 b·∫°n nam." },
            { question: "Trong h·ªôp c√≥ 1 qu·∫£ b√≥ng ƒë·ªè, 2 qu·∫£ xanh v√† 3 qu·∫£ v√†ng. T·ªïng c·ªông c√≥ bao nhi√™u qu·∫£ b√≥ng?", options: ["5 qu·∫£", "6 qu·∫£", "7 qu·∫£", "8 qu·∫£"], answer: 6, explanation: "1 + 2 + 3 = 6 qu·∫£ b√≥ng." },
            { question: "B·∫°n Mai c√≥ 13 b√¥ng hoa. Mai t·∫∑ng c√¥ gi√°o 6 b√¥ng. H·ªèi Mai c√≤n l·∫°i bao nhi√™u b√¥ng?", options: ["5 b√¥ng", "6 b√¥ng", "7 b√¥ng", "8 b√¥ng"], answer: 7, explanation: "13 - 6 = 7 b√¥ng hoa." },
            { question: "Anh c√≥ 7 cu·ªën truy·ªán. Em c√≥ s·ªë truy·ªán b·∫±ng anh. H·ªèi c·∫£ hai c√≥ bao nhi√™u cu·ªën?", options: ["13 cu·ªën", "14 cu·ªën", "15 cu·ªën", "7 cu·ªën"], answer: 14, explanation: "7 + 7 = 14 cu·ªën truy·ªán." },
            { question: "B√°c n√¥ng d√¢n h√°i ƒë∆∞·ª£c 20 qu·∫£ d∆∞a. B√°c b√°n ƒëi 7 qu·∫£. H·ªèi b√°c c√≤n l·∫°i bao nhi√™u qu·∫£ d∆∞a?", options: ["13 qu·∫£", "12 qu·∫£", "14 qu·∫£", "27 qu·∫£"], answer: 13, explanation: "20 - 7 = 13 qu·∫£ d∆∞a." },
            { question: "S·ªë l∆∞·ª£ng b√∫t ch√¨ trong h·ªôp l√† 6, th√™m 5 b√∫t n·ªØa. T·ªïng c·ªông l√† bao nhi√™u?", options: ["10 c√¢y", "11 c√¢y", "12 c√¢y", "13 c√¢y"], answer: 11, explanation: "6 + 5 = 11 c√¢y b√∫t." },
            { question: "Tr√™n b√†n c√≥ 14 quy·ªÉn s√°ch. B√© c·∫•t ƒëi 9 quy·ªÉn. C√≤n l·∫°i m·∫•y quy·ªÉn?", options: ["4 quy·ªÉn", "5 quy·ªÉn", "6 quy·ªÉn", "7 quy·ªÉn"], answer: 5, explanation: "14 - 9 = 5 quy·ªÉn s√°ch." },
            { question: "C√≥ 8 qu·∫£ cam trong r·ªï. M·∫π mua th√™m 8 qu·∫£. H·ªèi r·ªï c√≥ bao nhi√™u qu·∫£ cam?", options: ["15 qu·∫£", "16 qu·∫£", "17 qu·∫£", "18 qu·∫£"], answer: 16, explanation: "8 + 8 = 16 qu·∫£ cam." },
            { question: "T√πng c√≥ 11 vi√™n bi. T√πng ƒë√°nh r∆°i 3 vi√™n. H·ªèi T√πng c√≤n l·∫°i bao nhi√™u vi√™n?", options: ["7 vi√™n", "8 vi√™n", "9 vi√™n", "14 vi√™n"], answer: 8, explanation: "11 - 3 = 8 vi√™n bi." },
            { question: "Trang tr·∫°i c√≥ 9 con g√† v√† 4 con v·ªãt. H·ªèi t·ªïng c·ªông c√≥ bao nhi√™u con gia c·∫ßm?", options: ["12 con", "13 con", "14 con", "15 con"], answer: 13, explanation: "9 + 4 = 13 con." },
            { question: "Chi·∫øc xe bu√Ωt c√≥ 17 h√†nh kh√°ch. 5 ng∆∞·ªùi xu·ªëng xe. H·ªèi c√≤n l·∫°i bao nhi√™u ng∆∞·ªùi?", options: ["10 ng∆∞·ªùi", "11 ng∆∞·ªùi", "12 ng∆∞·ªùi", "22 ng∆∞·ªùi"], answer: 12, explanation: "17 - 5 = 12 ng∆∞·ªùi." },
            { question: "Lan ch·∫°y 10 m√©t, r·ªìi ch·∫°y th√™m 10 m√©t n·ªØa. T·ªïng c·ªông Lan ch·∫°y bao nhi√™u m√©t?", options: ["10 m√©t", "15 m√©t", "20 m√©t", "30 m√©t"], answer: 20, explanation: "10 + 10 = 20 m√©t." },
            { question: "C√≥ 16 chi·∫øc √¥ t√¥ ƒë·∫≠u trong b√£i. 7 chi·∫øc r·ªùi ƒëi. H·ªèi c√≤n l·∫°i bao nhi√™u √¥ t√¥?", options: ["8 chi·∫øc", "9 chi·∫øc", "10 chi·∫øc", "23 chi·∫øc"], answer: 9, explanation: "16 - 7 = 9 chi·∫øc √¥ t√¥." },
            { question: "M·∫π chia k·∫πo cho ba anh em. M·ªói ng∆∞·ªùi ƒë∆∞·ª£c 5 vi√™n. H·ªèi m·∫π ƒë√£ chia t·∫•t c·∫£ bao nhi√™u vi√™n k·∫πo?", options: ["10 vi√™n", "15 vi√™n", "20 vi√™n", "8 vi√™n"], answer: 15, explanation: "5 + 5 + 5 = 15 vi√™n k·∫πo." },
            { question: "M·ªôt con ki·∫øn c√≥ 6 ch√¢n. H·ªèi 2 con ki·∫øn c√≥ t·ªïng c·ªông m·∫•y ch√¢n?", options: ["8 ch√¢n", "10 ch√¢n", "12 ch√¢n", "6 ch√¢n"], answer: 12, explanation: "6 + 6 = 12 ch√¢n." },
            { question: "Trong v∆∞·ªùn c√≥ 7 b√¥ng hoa h·ªìng v√† 5 b√¥ng hoa c√∫c. H·ªèi hoa h·ªìng nhi·ªÅu h∆°n hoa c√∫c bao nhi√™u b√¥ng?", options: ["1 b√¥ng", "2 b√¥ng", "3 b√¥ng", "12 b√¥ng"], answer: 2, explanation: "7 - 5 = 2 b√¥ng." },
            { question: "B√© x·∫øp 12 kh·ªëi vu√¥ng. Sau ƒë√≥ b√© th√°o ra 4 kh·ªëi. H·ªèi c√≤n l·∫°i m·∫•y kh·ªëi vu√¥ng?", options: ["6 kh·ªëi", "7 kh·ªëi", "8 kh·ªëi", "9 kh·ªëi"], answer: 8, explanation: "12 - 4 = 8 kh·ªëi vu√¥ng." },
            { question: "B·∫°n H√† c√≥ 8 c√¢y b√∫t m√†u. B·ªë mua th√™m cho H√† 7 c√¢y. H·ªèi H√† c√≥ t·∫•t c·∫£ bao nhi√™u c√¢y b√∫t m√†u?", options: ["14 c√¢y", "15 c√¢y", "16 c√¢y", "1 c√¢y"], answer: 15, explanation: "8 + 7 = 15 c√¢y b√∫t." },
            { question: "Tr√™n m·ªôt c√†nh c√¢y c√≥ 19 chi·∫øc l√°. Gi√≥ th·ªïi r·ª•ng 9 chi·∫øc. H·ªèi c√≤n l·∫°i bao nhi√™u chi·∫øc l√°?", options: ["9 chi·∫øc", "10 chi·∫øc", "11 chi·∫øc", "28 chi·∫øc"], answer: 10, explanation: "19 - 9 = 10 chi·∫øc l√°." },
            { question: "S·ªë l·ªõn nh·∫•t c√≥ m·ªôt ch·ªØ s·ªë c·ªông v·ªõi 1 th√¨ b·∫±ng bao nhi√™u?", options: ["9", "10", "11", "0"], answer: 10, explanation: "S·ªë l·ªõn nh·∫•t c√≥ m·ªôt ch·ªØ s·ªë l√† 9. 9 + 1 = 10." },
            { question: "S·ªë nh·ªè nh·∫•t c√≥ hai ch·ªØ s·ªë tr·ª´ ƒëi 1 th√¨ b·∫±ng bao nhi√™u?", options: ["11", "10", "9", "8"], answer: 9, explanation: "S·ªë nh·ªè nh·∫•t c√≥ hai ch·ªØ s·ªë l√† 10. 10 - 1 = 9." },
            { question: "B√© l·∫•y 14 que kem, ƒÉn h·∫øt 4 que. H·ªèi c√≤n l·∫°i m·∫•y que kem?", options: ["9 que", "10 que", "11 que", "18 que"], answer: 10, explanation: "14 - 4 = 10 que kem." },
            { question: "C·ª≠a h√†ng b√°n 6 c√°i m≈© v√†o bu·ªïi s√°ng v√† 8 c√°i m≈© v√†o bu·ªïi chi·ªÅu. H·ªèi t·ªïng c·ªông b√°n ƒë∆∞·ª£c bao nhi√™u c√°i m≈©?", options: ["13 c√°i", "14 c√°i", "15 c√°i", "2 c√°i"], answer: 14, explanation: "6 + 8 = 14 c√°i m≈©." },
            { question: "Con c√≥ 15 con tem. Con cho b·∫°n 7 con tem. H·ªèi con c√≤n l·∫°i bao nhi√™u con?", options: ["7 con", "8 con", "9 con", "22 con"], answer: 8, explanation: "15 - 7 = 8 con tem." },
            { question: "M·∫π c√≥ 10 qu·∫£ tr·ª©ng g√† v√† 9 qu·∫£ tr·ª©ng v·ªãt. H·ªèi m·∫π c√≥ t·ªïng c·ªông bao nhi√™u qu·∫£ tr·ª©ng?", options: ["18 qu·∫£", "19 qu·∫£", "20 qu·∫£", "1 qu·∫£"], answer: 19, explanation: "10 + 9 = 19 qu·∫£ tr·ª©ng." },
            { question: "Anh c√≥ 12 vi√™n ph·∫•n. Em l·∫•y 5 vi√™n ƒë·ªÉ v·∫Ω. H·ªèi anh c√≤n l·∫°i m·∫•y vi√™n ph·∫•n?", options: ["6 vi√™n", "7 vi√™n", "8 vi√™n", "17 vi√™n"], answer: 7, explanation: "12 - 5 = 7 vi√™n ph·∫•n." },
            { question: "Tr√™n gi√° s√°ch c√≥ 16 cu·ªën s√°ch. Ba l·∫•y ƒëi 6 cu·ªën. H·ªèi c√≤n l·∫°i bao nhi√™u cu·ªën?", options: ["9 cu·ªën", "10 cu·ªën", "11 cu·ªën", "22 cu·ªën"], answer: 10, explanation: "16 - 6 = 10 cu·ªën s√°ch." },
            { question: "L·ªõp h·ªçc c√≥ 7 c√°i b√†n, m·ªói b√†n c√≥ 2 b·∫°n ng·ªìi. H·ªèi c√≥ bao nhi√™u b·∫°n ƒëang ng·ªìi? (7 + 7)", options: ["12 b·∫°n", "13 b·∫°n", "14 b·∫°n", "15 b·∫°n"], answer: 14, explanation: "7 + 7 = 14 b·∫°n." },
            { question: "B√© x·∫øp h√¨nh 18 chi·∫øc xe. B√© b·ªã h·ªèng 9 chi·∫øc. H·ªèi c√≤n l·∫°i bao nhi√™u chi·∫øc xe?", options: ["8 chi·∫øc", "9 chi·∫øc", "10 chi·∫øc", "27 chi·∫øc"], answer: 9, explanation: "18 - 9 = 9 chi·∫øc xe." },
            { question: "ƒê·ªôi b√≥ng c√≥ 11 c·∫ßu th·ªß tr√™n s√¢n. Th√™m 3 c·∫ßu th·ªß d·ª± b·ªã. H·ªèi ƒë·ªôi c√≥ t·∫•t c·∫£ bao nhi√™u c·∫ßu th·ªß?", options: ["13 c·∫ßu th·ªß", "14 c·∫ßu th·ªß", "15 c·∫ßu th·ªß", "8 c·∫ßu th·ªß"], answer: 14, explanation: "11 + 3 = 14 c·∫ßu th·ªß." },
            { question: "Con r√πa b√≤ ƒë∆∞·ª£c 5 m√©t. Con ·ªëc s√™n b√≤ k√©m h∆°n r√πa 3 m√©t. H·ªèi ·ªëc s√™n b√≤ ƒë∆∞·ª£c bao nhi√™u m√©t?", options: ["8 m√©t", "3 m√©t", "2 m√©t", "1 m√©t"], answer: 2, explanation: "5 - 3 = 2 m√©t." },
            { question: "B√© nh·∫∑t ƒë∆∞·ª£c 4 vi√™n s·ªèi. Sau ƒë√≥ nh·∫∑t th√™m 6 vi√™n. H·ªèi b√© c√≥ bao nhi√™u vi√™n s·ªèi?", options: ["9 vi√™n", "10 vi√™n", "11 vi√™n", "2 vi√™n"], answer: 10, explanation: "4 + 6 = 10 vi√™n s·ªèi." },
            { question: "B√© mu·ªën mua m·ªôt m√≥n ƒë·ªì ch∆°i 17 ngh√¨n. B√© ƒë√£ c√≥ 9 ngh√¨n. H·ªèi b√© c·∫ßn th√™m bao nhi√™u ngh√¨n n·ªØa?", options: ["7 ngh√¨n", "8 ngh√¨n", "9 ngh√¨n", "26 ngh√¨n"], answer: 8, explanation: "17 - 9 = 8 ngh√¨n." },
            { question: "T·ª´ s·ªë 1 ƒë·∫øn s·ªë 20, c√≥ bao nhi√™u s·ªë ch·∫µn?", options: ["9 s·ªë", "10 s·ªë", "11 s·ªë", "20 s·ªë"], answer: 10, explanation: "C√°c s·ªë ch·∫µn l√†: 2, 4, 6, 8, 10, 12, 14, 16, 18, 20 (10 s·ªë)." },
            { question: "Trong m·ªôt ph√©p t√≠nh, 5 c·ªông v·ªõi s·ªë n√†o th√¨ b·∫±ng 12?", options: ["6", "7", "8", "17"], answer: 7, explanation: "12 - 5 = 7." },
            { question: "N·∫øu l·∫•y 18 tr·ª´ ƒëi 8, sau ƒë√≥ c·ªông th√™m 1. K·∫øt qu·∫£ l√† bao nhi√™u?", options: ["10", "11", "9", "27"], answer: 11, explanation: "18 - 8 = 10. Sau ƒë√≥ 10 + 1 = 11." },
            { question: "B√© c√≥ 2 b√†n tay, m·ªói b√†n c√≥ 5 ng√≥n. H·ªèi b√© c√≥ bao nhi√™u ng√≥n tay?", options: ["5 ng√≥n", "10 ng√≥n", "12 ng√≥n", "7 ng√≥n"], answer: 10, explanation: "5 + 5 = 10 ng√≥n tay." },
            { question: "C√≥ 10 ng√≥n tay. H·ªèi 2 ng∆∞·ªùi b·∫°n c√≥ t·∫•t c·∫£ bao nhi√™u ng√≥n tay?", options: ["10 ng√≥n", "15 ng√≥n", "20 ng√≥n", "30 ng√≥n"], answer: 20, explanation: "10 + 10 = 20 ng√≥n tay." },
            { question: "S·ªë li·ªÅn tr∆∞·ªõc c·ªßa 15 l√† s·ªë n√†o?", options: ["13", "14", "16", "15"], answer: 14, explanation: "S·ªë li·ªÅn tr∆∞·ªõc c·ªßa 15 l√† 14." },
            { question: "S·ªë li·ªÅn sau c·ªßa 19 l√† s·ªë n√†o?", options: ["18", "19", "20", "21"], answer: 20, explanation: "S·ªë li·ªÅn sau c·ªßa 19 l√† 20." },
            { question: "B√© l·∫•y 13 vi√™n g·∫°ch x·∫øp th√†nh h√†ng. 4 vi√™n b·ªã ƒë·ªï. H·ªèi c√≤n l·∫°i bao nhi√™u vi√™n?", options: ["8 vi√™n", "9 vi√™n", "10 vi√™n", "17 vi√™n"], answer: 9, explanation: "13 - 4 = 9 vi√™n." },
            { question: "Ba mua 8 qu·∫£ chu·ªëi. Anh ƒÉn 3 qu·∫£, em ƒÉn 2 qu·∫£. H·ªèi c√≤n l·∫°i bao nhi√™u qu·∫£?", options: ["4 qu·∫£", "3 qu·∫£", "5 qu·∫£", "13 qu·∫£"], answer: 3, explanation: "8 - 3 = 5. Sau ƒë√≥ 5 - 2 = 3 qu·∫£." },
            { question: "12 con g√† ƒëang ƒëi d·∫°o. Th√™m 6 con n·ªØa nh·∫≠p ƒë√†n. H·ªèi c√≥ bao nhi√™u con g√†?", options: ["17 con", "18 con", "19 con", "6 con"], answer: 18, explanation: "12 + 6 = 18 con g√†." },
            { question: "B√© c√≥ 16 c√°i b√∫t m√†u. B√© d√πng h·∫øt 6 c√°i. H·ªèi b√© c√≤n l·∫°i bao nhi√™u c√°i b√∫t kh√¥ng d√πng?", options: ["9 c√°i", "10 c√°i", "11 c√°i", "22 c√°i"], answer: 10, explanation: "16 - 6 = 10 c√°i b√∫t." }
        ];

        // --- 2. KH·ªûI T·∫†O BI·∫æN TR·∫†NG TH√ÅI ---
        const totalQuestions = initialQuestions.length;
        let currentQuestionIndex = 0;
        let timerInterval = null;
        const TIMER_SECONDS = 180; // 3 ph√∫t

        // Kh·ªüi t·∫°o tr·∫°ng th√°i ti·∫øn ƒë·ªô c·ªßa ng∆∞·ªùi d√πng cho t·∫•t c·∫£ 50 c√¢u
        let userProgress = initialQuestions.map(q => ({
            ...q,
            userAnswer: null, // L∆∞u gi√° tr·ªã ƒë√°p √°n (s·ªë)
            isAnswered: false,
            isCorrect: null, // true, false, 'skipped'
        }));
        
        let correctCount = 0;
        let incorrectCount = 0;
        
        // --- 3. KH·ªûI T·∫†O √ÇM THANH (TONE.JS) ---
        let happySynth;
        let sadSynth;

        async function initializeAudio() {
            try {
                await Tone.start();
                happySynth = new Tone.MembraneSynth({"envelope": {"attack": 0.001, "decay": 0.3, "sustain": 0.01, "release": 0.1}}).toDestination();
                sadSynth = new Tone.Synth({"oscillator": {"type": "sawtooth"}, "envelope": {"attack": 0.005, "decay": 0.1, "sustain": 0.0, "release": 0.1}}).toDestination();
            } catch (error) {
                console.error("L·ªói kh·ªüi t·∫°o Audio Context:", error);
            }
        }
        
        initializeAudio();

        function playHappySound() { if (happySynth) { happySynth.triggerAttackRelease("C5", "8n"); happySynth.triggerAttackRelease("E5", "8n", "+0.15"); } }
        function playSadSound() { if (sadSynth) { sadSynth.triggerAttackRelease("C3", "16n"); sadSynth.triggerAttackRelease("B2", "16n", "+0.15"); } }


        // --- 4. C·∫¨P NH·∫¨T GIAO DI·ªÜN V√Ä TR·∫†NG TH√ÅI ---
        const $questionText = document.getElementById('questionText');
        const $optionsContainer = document.getElementById('optionsContainer');
        const $feedbackModal = document.getElementById('feedbackModal');
        const $feedbackEmoji = document.getElementById('feedbackEmoji');
        const $feedbackTitle = document.getElementById('feedbackTitle');
        const $feedbackMessage = document.getElementById('feedbackMessage');
        const $modalNextButton = document.getElementById('modalNextButton');
        const $quizEnd = document.getElementById('quizEnd');
        const $gameContainer = document.getElementById('gameContainer');
        const $prevButton = document.getElementById('prevButton');
        const $nextButton = document.getElementById('nextButton');
        const $timerDisplay = document.getElementById('timerDisplay');
        const $reviewModal = document.getElementById('reviewModal'); // New: Review Modal
        const $reviewList = document.getElementById('reviewList'); // New: Review List

        
        function updateStats() {
            correctCount = userProgress.filter(p => p.isCorrect === true).length;
            incorrectCount = userProgress.filter(p => p.isCorrect === false || p.isCorrect === 'skipped').length;

            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            document.getElementById('currentQuestionNumber').textContent = Math.min(currentQuestionIndex + 1, totalQuestions);
            document.getElementById('totalQuestions').textContent = totalQuestions;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function startTimer() {
            stopTimer();
            let timeLeft = TIMER_SECONDS;
            $timerDisplay.textContent = `‚è∞ ${formatTime(timeLeft)}`;
            $timerDisplay.classList.remove('low-time');

            timerInterval = setInterval(() => {
                timeLeft--;
                $timerDisplay.textContent = `‚è∞ ${formatTime(timeLeft)}`;

                if (timeLeft <= 30) {
                    $timerDisplay.classList.add('low-time');
                } else {
                    $timerDisplay.classList.remove('low-time');
                }

                if (timeLeft <= 0) {
                    stopTimer();
                    handleTimeout();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        function handleTimeout() {
            // Ch·ªâ ghi nh·∫≠n b·ªè qua n·∫øu ch∆∞a tr·∫£ l·ªùi
            if (userProgress[currentQuestionIndex].isAnswered === false) {
                userProgress[currentQuestionIndex].isAnswered = true;
                userProgress[currentQuestionIndex].isCorrect = 'skipped';
                incorrectCount++; // TƒÉng s·ªë c√¢u sai/b·ªè qua
                updateStats();
                
                // Hi·ªÉn th·ªã modal th√¥ng b√°o h·∫øt gi·ªù
                $feedbackModal.style.display = 'flex';
                $feedbackEmoji.textContent = '‚è±Ô∏è';
                $feedbackTitle.textContent = 'H·∫øt gi·ªù r·ªìi!';
                $feedbackTitle.className = 'text-3xl font-bold mt-2 mb-4 text-red-600';
                $feedbackMessage.textContent = `C√¢u n√†y ƒë√£ ƒë∆∞·ª£c b·ªè qua. ƒê√°p √°n ƒë√∫ng l√†: ${userProgress[currentQuestionIndex].explanation}`;
                
                setTimeout(() => { $modalNextButton.disabled = false; $modalNextButton.focus(); }, 500);
            } else {
                // N·∫øu ƒë√£ tr·∫£ l·ªùi r·ªìi th√¨ ch·ªâ c·∫ßn chuy·ªÉn c√¢u (tr∆∞·ªùng h·ª£p hi·∫øm)
                goToNextQuestion(true);
            }
        }

        function renderQuestion() {
            // Ki·ªÉm tra xem ƒë√¢y c√≥ ph·∫£i m√†n h√¨nh review kh√¥ng, n·∫øu c√≥ th√¨ kh√¥ng ch·∫°y timer
            const isReviewing = $reviewModal.style.display === 'flex';

            if (currentQuestionIndex >= totalQuestions) {
                showQuizEnd();
                return;
            }

            const current = userProgress[currentQuestionIndex];
            const isAnswered = current.isAnswered;
            
            $questionText.textContent = `${currentQuestionIndex + 1}. ${current.question}`;
            $optionsContainer.innerHTML = '';
            
            // Render options
            current.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button hover:bg-orange-600';
                button.textContent = option;
                button.onclick = () => handleAnswer(option); // L∆∞u gi√° tr·ªã ƒë√°p √°n thay v√¨ index
                button.setAttribute('data-answer', option);

                if (isAnswered || isReviewing) { // Lu√¥n v√¥ hi·ªáu h√≥a n√∫t n·∫øu ƒëang review
                    button.disabled = true;
                    if (parseInt(option) === current.answer) {
                        // ƒê√°p √°n ƒë√∫ng lu√¥n m√†u xanh l√°
                        button.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'bg-red-500', 'bg-gray-400');
                        button.classList.add('bg-green-500');
                        button.style.boxShadow = '0 4px #059669';
                    } else if (parseInt(option) === current.userAnswer) {
                        // ƒê√°p √°n ng∆∞·ªùi d√πng ch·ªçn (ch·ªâ khi sai)
                        button.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'bg-green-500', 'bg-gray-400');
                        button.classList.add('bg-red-500');
                        button.style.boxShadow = '0 4px #dc2626';
                    } else {
                        // ƒê√°p √°n kh√¥ng ch·ªçn v√† kh√¥ng ph·∫£i ƒë√°p √°n ƒë√∫ng
                        button.classList.add('bg-gray-400');
                        button.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'bg-green-500', 'bg-red-500');
                    }
                }
                
                $optionsContainer.appendChild(button);
            });
            
            // C·∫≠p nh·∫≠t Timer v√† Navigation
            stopTimer();
            if (!isAnswered && !isReviewing) {
                startTimer();
                // FIX: D√πng innerHTML ƒë·ªÉ hi·ªÉn th·ªã k√Ω t·ª± arrow ƒë√∫ng c√°ch
                $nextButton.innerHTML = 'B·ªè Qua &nbsp;&#9654;';
                $timerDisplay.classList.remove('bg-green-500', 'text-white');
                $timerDisplay.classList.add('bg-red-500');
            } else {
                $timerDisplay.textContent = '‚úÖ ƒê√£ tr·∫£ l·ªùi';
                $timerDisplay.classList.remove('bg-red-500', 'low-time');
                $timerDisplay.classList.add('bg-green-500');
                // FIX: D√πng innerHTML ƒë·ªÉ hi·ªÉn th·ªã k√Ω t·ª± arrow ƒë√∫ng c√°ch
                $nextButton.innerHTML = 'Ti·∫øp Theo &nbsp;&#9654;';
            }
            
            // N√∫t ƒëi·ªÅu h∆∞·ªõng
            $prevButton.disabled = currentQuestionIndex === 0;
            // N·∫øu ƒëang review th√¨ cho ph√©p ƒëi t·ªõi/lui
            if (isReviewing) {
                 $prevButton.onclick = goToPreviousQuestion;
                 $nextButton.onclick = goToNextQuestion;
                 $prevButton.disabled = currentQuestionIndex === 0;
                 $nextButton.disabled = currentQuestionIndex === totalQuestions - 1;
            } else {
                // Logic b√¨nh th∆∞·ªùng
                $nextButton.disabled = currentQuestionIndex === totalQuestions - 1 && isAnswered; 
            }

            updateStats();
        }

        function handleAnswer(selectedOption) {
            stopTimer(); // D·ª´ng timer ngay l·∫≠p t·ª©c

            const current = userProgress[currentQuestionIndex];
            if (current.isAnswered) return; 

            // parseInt(selectedOption) v√¨ ƒë√°p √°n l√† s·ªë
            const isCorrect = (parseInt(selectedOption) === current.answer);
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i
            current.isAnswered = true;
            current.userAnswer = parseInt(selectedOption);
            current.isCorrect = isCorrect;
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            updateStats();

            // Hi·ªÉn th·ªã ph·∫£n h·ªìi
            showFeedback(isCorrect, current.explanation);
            
            // C·∫≠p nh·∫≠t l·∫°i giao di·ªán n√∫t ƒë√°p √°n
            renderQuestion(); 
        }

        function showFeedback(isCorrect, explanation) {
            $feedbackModal.style.display = 'flex';
            $modalNextButton.disabled = true;

            if (isCorrect) {
                $feedbackEmoji.textContent = 'ü•≥';
                $feedbackTitle.textContent = 'Tuy·ªát v·ªùi!';
                $feedbackTitle.className = 'text-3xl font-bold mt-2 mb-4 text-green-600';
                $feedbackMessage.textContent = 'Ch√≠nh x√°c r·ªìi! Con th·∫≠t th√¥ng minh.';
                playHappySound();
            } else {
                $feedbackEmoji.textContent = 'üò¢';
                $feedbackTitle.textContent = 'Ch∆∞a ƒë√∫ng r·ªìi!';
                $feedbackTitle.className = 'text-3xl font-bold mt-2 mb-4 text-red-600';
                $feedbackMessage.textContent = `ƒê√°p √°n ƒë√∫ng l√†: ${explanation}`;
                playSadSound();
            }

            // Cho ph√©p chuy·ªÉn c√¢u h·ªèi sau 0.5 gi√¢y
            setTimeout(() => {
                $modalNextButton.disabled = false;
                $modalNextButton.focus();
            }, 500);
        }
        
        function goToPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function goToNextQuestion(isFromModal = false) {
             if (currentQuestionIndex < totalQuestions - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                // N·∫øu l√† c√¢u cu·ªëi c√πng
                showQuizEnd();
            }
        }

        // --- CH·ª®C NƒÇNG √îN T·∫¨P (REVIEW) M·ªöI ---
        
        function showReviewScreen() {
            $quizEnd.classList.add('hidden'); // ·∫®n m√†n h√¨nh k·∫øt th√∫c
            $reviewModal.style.display = 'flex'; // Hi·ªán m√†n h√¨nh √¥n t·∫≠p
            
            document.getElementById('reviewCorrect').textContent = correctCount;
            document.getElementById('reviewIncorrect').textContent = incorrectCount;
            $reviewList.innerHTML = '';

            userProgress.forEach((q, index) => {
                const item = document.createElement('div');
                let statusText = 'Ch∆∞a tr·∫£ l·ªùi';
                let statusClass = 'bg-gray-100 border-gray-300 text-gray-700';
                let statusEmoji = '‚ùì';

                if (q.isCorrect === true) {
                    statusText = 'ƒê√∫ng';
                    statusClass = 'bg-green-100 border-green-500 text-green-700';
                    statusEmoji = '‚úÖ';
                } else if (q.isCorrect === false) {
                    statusText = 'Sai';
                    statusClass = 'bg-red-100 border-red-500 text-red-700';
                    statusEmoji = '‚ùå';
                } else if (q.isCorrect === 'skipped') {
                    statusText = 'B·ªè qua';
                    statusClass = 'bg-yellow-100 border-yellow-500 text-yellow-700';
                    statusEmoji = '‚è≠Ô∏è';
                }
                
                // Th√™m hi·ªáu ·ª©ng hover v√† padding/margin
                item.className = `${statusClass} p-3 rounded-lg flex justify-between items-center cursor-pointer border-2 hover:shadow-md transition duration-200`;
                item.innerHTML = `
                    <div class="flex items-center space-x-2 w-4/5 text-left">
                        <span class="font-bold text-lg">${index + 1}.</span>
                        <p class="truncate text-sm sm:text-base">${q.question}</p>
                    </div>
                    <div class="flex items-center flex-shrink-0">
                        <span class="font-semibold text-sm mr-2 hidden sm:inline">${statusText}</span>
                        <span class="text-xl">${statusEmoji}</span>
                    </div>
                `;
                item.onclick = () => jumpToQuestion(index);
                $reviewList.appendChild(item);
            });
        }

        function hideReviewScreen() {
            $reviewModal.style.display = 'none';
            $quizEnd.classList.remove('hidden'); // Hi·ªán m√†n h√¨nh k·∫øt th√∫c
        }

        function jumpToQuestion(index) {
            currentQuestionIndex = index;
            $reviewModal.style.display = 'none';
            $quizEnd.classList.add('hidden');
            // ƒê·∫£m b·∫£o container game ƒë∆∞·ª£c hi·ªÉn th·ªã
            $gameContainer.classList.remove('hidden'); 
            
            // ƒê·∫∑t l·∫°i c√°c n√∫t ƒëi·ªÅu h∆∞·ªõng ƒë·ªÉ cho ph√©p di chuy·ªÉn trong ch·∫ø ƒë·ªô review
            $prevButton.onclick = goToPreviousQuestion;
            $nextButton.onclick = goToNextQuestion;
            
            renderQuestion();
        }
        // --- K·∫æT TH√öC CH·ª®C NƒÇNG √îN T·∫¨P ---


        // Handlers cho n√∫t ƒëi·ªÅu h∆∞·ªõng ch√≠nh
        $nextButton.onclick = () => goToNextQuestion(false);
        $prevButton.onclick = goToPreviousQuestion;
        $modalNextButton.onclick = () => {
            $feedbackModal.style.display = 'none';
            goToNextQuestion(true);
        };


        function showQuizEnd() {
            stopTimer();
            $gameContainer.classList.add('hidden');
            $quizEnd.classList.remove('hidden');
            document.getElementById('finalScore').textContent = `${correctCount}/${totalQuestions} c√¢u ƒë√∫ng!`;
        }

        // --- 5. KH·ªûI CH·∫†Y ---
        window.onload = () => {
            renderQuestion();
        };
        
    </script>

</body>
</html>
